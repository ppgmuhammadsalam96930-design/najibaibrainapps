<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAJIB AI BRAIN - Quantum QR Scanner Mathematics Kelas 3 v6.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        /* CSS tetap sama seperti sebelumnya */
        :root {
            --quantum-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --quantum-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --quantum-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --quantum-danger: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            --quantum-warning: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
            --quantum-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --quantum-dark: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --quantum-light: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);

            --bg-primary: #0a0e27;
            --bg-secondary: #141b3d;
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --border-color: rgba(102, 126, 234, 0.3);
            --glow: 0 0 30px rgba(102, 126, 234, 0.5);
            --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.3);

            --font-display: 'Orbitron', sans-serif;
            --font-body: 'Inter', sans-serif;

            --iphone-radius: 47px;
            --dynamic-island-height: 37px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245, 87, 108, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(56, 239, 125, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .iphone-container {
            max-width: 430px;
            margin: 0 auto;
            position: relative;
            background: var(--bg-primary);
            min-height: 100vh;
            box-shadow: 0 0 60px rgba(102, 126, 234, 0.3);
        }

        @media (min-width: 768px) {
            .iphone-container {
                margin: 20px auto;
                border-radius: var(--iphone-radius);
                overflow: hidden;
                border: 3px solid rgba(102, 126, 234, 0.5);
            }
        }

        /* Dynamic Island */
        .dynamic-island {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 27, 61, 0.95));
            backdrop-filter: blur(20px);
            border-radius: 40px;
            padding: 8px 20px;
            min-width: 200px;
            height: var(--dynamic-island-height);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .dynamic-island.expanded {
            min-width: 320px;
            height: 80px;
            border-radius: 30px;
            padding: 15px 25px;
        }

        .island-content {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: var(--font-display);
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .island-icon {
            font-size: 18px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* Header with Logo */
        .quantum-header {
            position: relative;
            padding: 80px 20px 30px;
            text-align: center;
            background: linear-gradient(180deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
            border-bottom: 2px solid var(--border-color);
            z-index: 1;
        }

        .quantum-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            position: relative;
            animation: logoFloat 3s ease-in-out infinite;
        }

        .quantum-logo::before {
            content: '';
            position: absolute;
            inset: -10px;
            background: conic-gradient(from 0deg, #667eea, #764ba2, #f093fb, #f5576c, #667eea);
            border-radius: 50%;
            filter: blur(15px);
            opacity: 0.7;
            animation: rotate 3s linear infinite;
            z-index: -1;
        }

        .quantum-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: contain;
            border: 4px solid rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: var(--glow);
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-title {
            font-family: var(--font-display);
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        .header-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .patent-badge {
            display: inline-block;
            background: var(--quantum-warning);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
            font-family: var(--font-display);
            box-shadow: 0 4px 15px rgba(253, 187, 45, 0.4);
            margin-top: 10px;
        }

        /* Main Content */
        .main-content {
            position: relative;
            z-index: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Section */
        .section {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-soft);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.6);
        }

        .section-title {
            font-family: var(--font-display);
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            background: var(--quantum-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.8rem;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
            border: 2px solid var(--border-color);
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--font-display);
        }

        .mode-btn.active {
            background: var(--quantum-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* QR Scanner */
        #qr-reader {
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid var(--border-color);
            position: relative;
            width: 100%;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
        }

        #qr-reader.scanning {
            border: 3px solid #38ef7d !important;
            box-shadow: 0 0 20px rgba(56, 239, 125, 0.5) !important;
        }

        #qr-reader.error {
            border: 3px solid #fc466b !important;
        }

        #qr-reader video {
            border-radius: 17px;
            width: 100%;
            height: auto;
            max-height: 400px;
        }

        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 17px;
            z-index: 10;
        }

        .scanner-guide {
            width: 200px;
            height: 200px;
            border: 2px solid #38ef7d;
            border-radius: 15px;
            position: relative;
            animation: pulse 2s infinite;
        }

        .scanner-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* Google Lens Integration */
        .lens-integration {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .lens-integration h3 {
            font-family: var(--font-display);
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .lens-integration p {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .lens-btn {
            background: linear-gradient(135deg, #4285F4, #34A853, #FBBC05, #EA4335);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 5px;
        }

        .lens-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.6);
        }

        .lens-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .lens-feature {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .lens-feature i {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4285F4, #34A853);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lens-feature span {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Scan Result Display */
        .scan-result-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
        }

        .result-type {
            display: inline-block;
            background: var(--quantum-info);
            color: white;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 12px;
            font-family: var(--font-display);
        }

        .result-content {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.6;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Scan History */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateX(5px);
        }

        .history-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .history-preview {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Question Card */
        .question-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-option {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .answer-option:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .answer-option.selected {
            background: var(--quantum-primary);
            border-color: #667eea;
        }

        .answer-option.correct {
            background: var(--quantum-success);
            border-color: #11998e;
        }

        .answer-option.wrong {
            background: var(--quantum-danger);
            border-color: #fc466b;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        /* Buttons */
        .quantum-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 15px;
            font-family: var(--font-display);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            color: white;
        }

        .quantum-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .quantum-btn:active::before {
            width: 300px;
            height: 300px;
        }

        .quantum-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary {
            background: var(--quantum-primary);
        }

        .btn-success {
            background: var(--quantum-success);
        }

        .btn-danger {
            background: var(--quantum-danger);
        }

        .btn-warning {
            background: var(--quantum-warning);
        }

        .btn-info {
            background: var(--quantum-info);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            font-family: var(--font-display);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            background: var(--quantum-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: var(--font-display);
        }

        /* Topics Grid */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .topic-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .topic-card:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .topic-card.active {
            background: var(--quantum-primary);
            border-color: #667eea;
        }

        .topic-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .topic-name {
            font-weight: 700;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 3px solid var(--border-color);
            border-radius: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Character Gallery */
        .character-gallery {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .character-gallery {
                right: 10px;
                gap: 8px;
            }
        }

        .character-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--quantum-primary);
            border: 3px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .character-btn:hover {
            transform: scale(1.2) rotate(10deg);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .character-btn .tooltip {
            position: absolute;
            right: 60px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .character-btn:hover .tooltip {
            opacity: 1;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1));
            border: 2px solid rgba(17, 153, 142, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        .info-box strong {
            color: #38ef7d;
            font-family: var(--font-display);
        }

        /* QR Code Display */
        .qr-display-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .qr-code-item {
            background: white;
            padding: 10px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .qr-code-item canvas {
            width: 100% !important;
            height: auto !important;
        }

        .qr-label {
            margin-top: 8px;
            font-weight: 700;
            font-size: 11px;
            color: #333;
        }

        /* Canva Template Styles */
        .canva-template {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .canva-template img {
            max-width: 100%;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .canva-instructions {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .canva-download-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .canva-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Feedback */
        .feedback {
            padding: 15px;
            border-radius: 15px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.2), rgba(56, 239, 125, 0.2));
            border: 2px solid #11998e;
            color: #38ef7d;
        }

        .feedback.wrong {
            background: linear-gradient(135deg, rgba(252, 70, 107, 0.2), rgba(63, 94, 251, 0.2));
            border: 2px solid #fc466b;
            color: #f5576c;
        }

        /* Camera Permission Styles */
        .camera-permission {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 20px 0;
        }

        .camera-permission i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #667eea;
        }

        .permission-steps {
            text-align: left;
            margin: 20px 0;
            padding: 0 20px;
        }

        .permission-steps li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        /* Google Lens Result Styles */
        .lens-result {
            background: linear-gradient(135deg, rgba(66, 133, 244, 0.15), rgba(52, 168, 83, 0.15));
            border: 2px solid rgba(66, 133, 244, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .lens-result-title {
            font-family: var(--font-display);
            font-size: 1.2rem;
            color: #4285F4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lens-result-content {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .lens-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .lens-action-btn {
            background: linear-gradient(135deg, #4285F4, #34A853);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .lens-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.4);
        }
        
        /* Enhanced Google Lens Integration */
        .lens-advanced {
            background: linear-gradient(135deg, rgba(66, 133, 244, 0.1), rgba(52, 168, 83, 0.1));
            border: 2px solid rgba(66, 133, 244, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .lens-advanced h4 {
            font-family: var(--font-display);
            color: #4285F4;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .lens-advanced-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .lens-advanced-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .lens-advanced-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }
        
        .lens-advanced-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .lens-advanced-text {
            font-size: 13px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <!-- Dynamic Island -->
        <div class="dynamic-island" id="dynamicIsland">
            <div class="island-content">
                <span class="island-icon">üì±</span>
                <span id="islandText">Quantum QR Scanner</span>
            </div>
        </div>

        <!-- Header -->
        <header class="quantum-header fade-in">
            <div class="quantum-logo">
                <img src="https://pfst.cf2.poecdn.net/base/image/450b057a0166b3d912e628ec6196299c9664597953096114352df3ff0dadf34f?w=3100&h=3100" alt="NAJIB AI BRAIN Logo">
            </div>
            <h1 class="header-title">NAJIB AI BRAIN</h1>
            <h2 class="header-subtitle">Quantum QR Scanner Mathematics v6.0</h2>
            <div class="patent-badge">
                üèÜ PAT-NAJIB-AI-BRAIN-QR-MATH-v6.0-2025
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Enhanced Google Lens Integration -->
            <section class="section fade-in">
                <h2 class="section-title">
                    <i class="fab fa-google"></i>
                    Enhanced Google Lens Integration
                </h2>
                <div class="lens-integration">
                    <h3>üîç Akses Universal Google Lens</h3>
                    <p>Dengan integrasi Google Lens yang ditingkatkan, aplikasi ini dapat memindai dan mengenali objek, teks, tempat, dan banyak lagi menggunakan teknologi AI canggih Google.</p>
                    
                    <div class="scanner-controls">
                        <button class="lens-btn" id="openLensBtn">
                            <i class="fab fa-google"></i> Buka Google Lens
                        </button>
                        <button class="quantum-btn btn-info" id="uploadImageBtn">
                            <i class="fas fa-upload"></i> Upload Gambar untuk Lens
                        </button>
                        <button class="quantum-btn btn-warning" id="directLensBtn">
                            <i class="fas fa-external-link-alt"></i> Direct Lens Access
                        </button>
                    </div>
                    
                    <div class="lens-features">
                        <div class="lens-feature">
                            <i class="fas fa-text-height"></i>
                            <span>Scan Teks</span>
                        </div>
                        <div class="lens-feature">
                            <i class="fas fa-barcode"></i>
                            <span>QR & Barcode</span>
                        </div>
                        <div class="lens-feature">
                            <i class="fas fa-landmark"></i>
                            <span>Tempat & Landmark</span>
                        </div>
                        <div class="lens-feature">
                            <i class="fas fa-shopping-bag"></i>
                            <span>Produk & Belanja</span>
                        </div>
                        <div class="lens-feature">
                            <i class="fas fa-leaf"></i>
                            <span>Tumbuhan & Hewan</span>
                        </div>
                        <div class="lens-feature">
                            <i class="fas fa-language"></i>
                            <span>Terjemahan</span>
                        </div>
                    </div>
                    
                    <!-- Enhanced Lens Features -->
                    <div class="lens-advanced">
                        <h4>üöÄ Fitur Google Lens Lanjutan</h4>
                        <div class="lens-advanced-grid">
                            <div class="lens-advanced-item">
                                <div class="lens-advanced-icon">üì∏</div>
                                <div class="lens-advanced-text">Real-time Camera Access</div>
                            </div>
                            <div class="lens-advanced-item">
                                <div class="lens-advanced-icon">üîç</div>
                                <div class="lens-advanced-text">AI Object Recognition</div>
                            </div>
                            <div class="lens-advanced-item">
                                <div class="lens-advanced-icon">üìö</div>
                                <div class="lens-advanced-text">Homework Help</div>
                            </div>
                            <div class="lens-advanced-item">
                                <div class="lens-advanced-icon">üåê</div>
                                <div class="lens-advanced-text">Web Integration</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <strong>üì± Cara Menggunakan Google Lens:</strong><br>
                        1. Klik "Buka Google Lens" untuk mengakses fitur lengkap<br>
                        2. Atau upload gambar untuk dianalisis oleh Lens<br>
                        3. Hasil scan akan otomatis terintegrasi dengan aplikasi ini<br>
                        4. Gunakan untuk scan soal matematika, teks, atau objek apapun<br>
                        5. <strong>NEW:</strong> Direct Lens Access untuk smartphone dengan aplikasi Lens
                    </div>
                    
                    <!-- Google Lens Result Display -->
                    <div id="lensResult" style="display: none; margin-top: 20px;">
                        <div class="lens-result">
                            <div class="lens-result-title">
                                <i class="fab fa-google"></i> Hasil Analisis Google Lens
                            </div>
                            <div class="lens-result-content" id="lensResultContent">
                                Hasil analisis akan muncul di sini...
                            </div>
                            <div class="lens-actions">
                                <button class="lens-action-btn" id="copyLensResultBtn">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="lens-action-btn" id="saveLensResultBtn">
                                    <i class="fas fa-save"></i> Save
                                </button>
                                <button class="lens-action-btn" id="shareLensResultBtn">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Mode Selection -->
            <section class="section fade-in">
                <h2 class="section-title">
                    <i class="fas fa-toggle-on"></i>
                    Mode Scanner
                </h2>
                <div class="mode-toggle">
                    <button class="mode-btn active" id="mathModeBtn">
                        <i class="fas fa-calculator"></i> Mode Soal Matematika
                    </button>
                    <button class="mode-btn" id="universalModeBtn">
                        <i class="fas fa-globe"></i> Mode Universal (Scan Apapun)
                    </button>
                </div>
                <div class="info-box">
                    <strong id="modeInfo">üìö Mode Soal Matematika:</strong> 
                    <span id="modeDescription">Scan QR code soal matematika kelas 3 SD (Perkalian, Pembagian, Pecahan)</span>
                </div>
            </section>

            <!-- Info Section -->
            <section class="section fade-in">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Informasi Aplikasi
                </h2>
                <div class="info-box">
                    <strong>üìö Materi Kelas 3 SD:</strong> Perkalian, Pembagian, dan Pecahan<br>
                    <strong>üì± Cara Pakai:</strong>
                    1. Klik tombol "Buka Kamera" untuk scan QR Code<br>
                    2. Arahkan kamera ke QR Code yang sudah dicetak<br>
                    3. Soal otomatis muncul dan kamu bisa langsung jawab!<br>
                    4. Atau pilih mode manual untuk latihan tanpa QR Code
                    <br><br>
                    <strong>üì± Tips Kamera:</strong><br>
                    ‚Ä¢ Pastikan izin kamera diberikan<br>
                    ‚Ä¢ Gunakan Chrome/Firefox untuk hasil terbaik<br>
                    ‚Ä¢ Pastikan ruangan cukup terang<br>
                    ‚Ä¢ Fokuskan QR code di kotak scanner
                </div>
            </section>

            <!-- Camera Permission Info -->
            <section class="section fade-in" id="cameraPermissionSection">
                <h2 class="section-title">
                    <i class="fas fa-camera"></i>
                    Izin Kamera
                </h2>
                <div class="camera-permission">
                    <i class="fas fa-camera"></i>
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">Akses Kamera Diperlukan</h3>
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        Untuk menggunakan QR Scanner, Anda perlu memberikan izin akses kamera.
                    </p>
                    <div class="permission-steps">
                        <ol>
                            <li>Klik tombol "Buka Kamera" di bawah</li>
                            <li>Izinkan akses kamera ketika browser meminta</li>
                            <li>Jika ditolak, refresh halaman dan coba lagi</li>
                            <li>Pastikan tidak ada aplikasi lain yang menggunakan kamera</li>
                        </ol>
                    </div>
                    <button class="quantum-btn btn-primary" id="testCameraBtn">
                        <i class="fas fa-camera"></i> Test Kamera Sekarang
                    </button>
                </div>
            </section>

            <!-- QR Scanner Section -->
            <section class="section fade-in" id="scannerSection">
                <h2 class="section-title">
                    <i class="fas fa-qrcode"></i>
                    QR Code Scanner
                </h2>

                <div class="scanner-controls">
                    <button class="quantum-btn btn-primary" id="startScannerBtn">
                        <i class="fas fa-camera"></i> Buka Kamera
                    </button>
                    <button class="quantum-btn btn-danger" id="stopScannerBtn">
                        <i class="fas fa-stop"></i> Tutup Kamera
                    </button>
                    <button class="quantum-btn btn-info" id="showQRBtn">
                        <i class="fas fa-print"></i> Lihat QR Codes
                    </button>
                    <button class="quantum-btn btn-warning" id="showCanvaBtn">
                        <i class="fab fa-canva"></i> Template Canva
                    </button>
                </div>

                <div id="qr-reader">
                    <div class="scanner-overlay" id="scannerOverlay">
                        <div class="scanner-guide"></div>
                    </div>
                    <div id="scanner-status" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <i class="fas fa-camera" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Kamera belum diaktifkan. Klik "Buka Kamera" untuk memulai.</p>
                    </div>
                </div>

                <div id="scanResult" style="display: none; margin-top: 15px;">
                    <div class="info-box">
                        <strong>‚úÖ QR Code Terdeteksi:</strong><br>
                        <span id="scanResultText"></span>
                    </div>
                </div>
            </section>

            <!-- Universal Scan Result -->
            <section class="section fade-in" id="universalResultSection" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-eye"></i>
                    Hasil Scan QR Code
                </h2>

                <div class="scan-result-card">
                    <span class="result-type" id="resultType">üìÑ TEXT</span>
                    <div class="result-content" id="resultContent"></div>
                    <div class="result-actions">
                        <button class="quantum-btn btn-success" id="copyBtn">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="quantum-btn btn-info" id="openUrlBtn">
                            <i class="fas fa-external-link-alt"></i> Buka Link
                        </button>
                        <button class="quantum-btn btn-warning" id="shareBtn">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                </div>
            </section>

            <!-- Scan History -->
            <section class="section fade-in" id="historySection" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    Riwayat Scan (<span id="historyCount">0</span>)
                </h2>
                <div class="history-list" id="historyList"></div>
                <button class="quantum-btn btn-danger" id="clearHistoryBtn">
                    <i class="fas fa-trash"></i> Hapus Semua Riwayat
                </button>
            </section>

            <!-- Topic Selection -->
            <section class="section fade-in" id="topicSection">
                <h2 class="section-title">
                    <i class="fas fa-list"></i>
                    Pilih Materi (Mode Manual)
                </h2>
                <div class="topics-grid">
                    <div class="topic-card" data-topic="perkalian">
                        <div class="topic-icon">‚úñÔ∏è</div>
                        <div class="topic-name">Perkalian</div>
                    </div>
                    <div class="topic-card" data-topic="pembagian">
                        <div class="topic-icon">‚ûó</div>
                        <div class="topic-name">Pembagian</div>
                    </div>
                    <div class="topic-card" data-topic="pecahan">
                        <div class="topic-icon">üçï</div>
                        <div class="topic-name">Pecahan</div>
                    </div>
                </div>
            </section>

            <!-- Question Section -->
            <section class="section fade-in" id="questionSection" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-question-circle"></i>
                    Soal Latihan
                </h2>

                <div class="question-card" id="questionCard">
                    <div class="question-text" id="questionText"></div>
                    <div id="answerArea"></div>
                    <button class="quantum-btn btn-success" id="checkAnswerBtn">
                        <i class="fas fa-check"></i> Cek Jawaban
                    </button>
                    <div id="feedback"></div>
                </div>

                <button class="quantum-btn btn-primary" id="nextQuestionBtn">
                    <i class="fas fa-forward"></i> Soal Berikutnya
                </button>
            </section>

            <!-- Statistics -->
            <section class="section fade-in">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Statistik Belajar
                </h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">QR SCANNED</div>
                        <div class="stat-value" id="qrScanned">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">BENAR</div>
                        <div class="stat-value" id="correctAnswers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SALAH</div>
                        <div class="stat-value" id="wrongAnswers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SKOR</div>
                        <div class="stat-value" id="totalScore">0</div>
                    </div>
                </div>
            </section>

            <!-- Action Buttons -->
            <section class="section fade-in">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="quantum-btn btn-success" id="developerInfoBtn">
                        <i class="fas fa-user-astronaut"></i> Developer Info
                    </button>
                    <button class="quantum-btn btn-warning" id="exportProgressBtn">
                        <i class="fas fa-file-export"></i> Export Rapor
                    </button>
                    <button class="quantum-btn btn-info" id="tutorialBtn">
                        <i class="fas fa-question-circle"></i> Tutorial
                    </button>
                </div>
            </section>
        </main>

        <!-- Character Gallery -->
        <div class="character-gallery">
            <div class="character-btn" data-character="scanner">
                üì±
                <span class="tooltip">QR Scanner</span>
            </div>
            <div class="character-btn" data-character="universal">
                üåê
                <span class="tooltip">Universal Mode</span>
            </div>
            <div class="character-btn" data-character="kali">
                ‚úñÔ∏è
                <span class="tooltip">Perkalian</span>
            </div>
            <div class="character-btn" data-character="bagi">
                ‚ûó
                <span class="tooltip">Pembagian</span>
            </div>
            <div class="character-btn" data-character="pecahan">
                üçï
                <span class="tooltip">Pecahan</span>
            </div>
            <div class="character-btn" data-character="guru">
                üéì
                <span class="tooltip">Teacher</span>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal" id="modal">
            <div class="modal-content" id="modalContent"></div>
        </div>
        
        <!-- Hidden file input for image upload -->
        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // Global State
        const QuantumMath = {
            scanner: null,
            isScanning: false,
            currentMode: 'math', // 'math' or 'universal'
            currentTopic: null,
            currentQuestion: null,
            userAnswer: null,
            lastScannedData: null,
            scanHistory: [],
            lensHistory: [],
            stats: {
                qrScanned: 0,
                correct: 0,
                wrong: 0,
                score: 0,
                sessionStart: Date.now(),
                lensUsed: 0
            },
            questions: {
                perkalian: [
                    { q: '3 √ó 4 = ...', a: 12, type: 'input', id: 'QR-KALI-001' },
                    { q: '5 √ó 6 = ...', a: 30, type: 'input', id: 'QR-KALI-002' },
                    { q: '7 √ó 8 = ...', a: 56, type: 'input', id: 'QR-KALI-003' },
                    { q: '9 √ó 9 = ...', a: 81, type: 'input', id: 'QR-KALI-004' },
                    { q: '6 √ó 7 = ...', a: 42, type: 'input', id: 'QR-KALI-005' },
                    { q: 'Ayah membeli 4 kotak pensil. Setiap kotak berisi 6 pensil. Berapa jumlah pensil seluruhnya?', options: [20, 24, 28, 30], a: 24, type: 'choice', id: 'QR-KALI-006' },
                    { q: 'Ibu membuat 5 baris kue. Setiap baris ada 8 kue. Berapa total kue?', options: [35, 40, 45, 50], a: 40, type: 'choice', id: 'QR-KALI-007' },
                    { q: '3 √ó 9 = ...', a: 27, type: 'input', id: 'QR-KALI-008' },
                    { q: '8 √ó 7 = ...', a: 56, type: 'input', id: 'QR-KALI-009' },
                    { q: 'Ada 6 kelompok siswa. Setiap kelompok terdiri dari 5 siswa. Berapa total siswa?', options: [25, 30, 35, 40], a: 30, type: 'choice', id: 'QR-KALI-010' }
                ],
                pembagian: [
                    { q: '12 √∑ 3 = ...', a: 4, type: 'input', id: 'QR-BAGI-001' },
                    { q: '24 √∑ 6 = ...', a: 4, type: 'input', id: 'QR-BAGI-002' },
                    { q: '35 √∑ 7 = ...', a: 5, type: 'input', id: 'QR-BAGI-003' },
                    { q: '48 √∑ 8 = ...', a: 6, type: 'input', id: 'QR-BAGI-004' },
                    { q: '56 √∑ 7 = ...', a: 8, type: 'input', id: 'QR-BAGI-005' },
                    { q: 'Ibu memiliki 20 permen yang akan dibagikan kepada 4 anak sama rata. Berapa permen untuk setiap anak?', options: [4, 5, 6, 7], a: 5, type: 'choice', id: 'QR-BAGI-006' },
                    { q: 'Pak Budi mempunyai 36 jeruk. Jeruk tersebut akan dimasukkan ke dalam 6 keranjang sama banyak. Berapa jeruk di setiap keranjang?', options: [5, 6, 7, 8], a: 6, type: 'choice', id: 'QR-BAGI-007' },
                    { q: '45 √∑ 9 = ...', a: 5, type: 'input', id: 'QR-BAGI-008' },
                    { q: '64 √∑ 8 = ...', a: 8, type: 'input', id: 'QR-BAGI-009' },
                    { q: 'Ada 28 siswa akan dibagi menjadi 7 kelompok. Berapa siswa per kelompok?', options: [3, 4, 5, 6], a: 4, type: 'choice', id: 'QR-BAGI-010' }
                ],
                pecahan: [
                    { q: 'Sebuah pizza dipotong menjadi 4 bagian sama besar. Jika kamu makan 1 potong, berapa bagian yang kamu makan?', options: ['1/2', '1/3', '1/4', '1/5'], a: '1/4', type: 'choice', id: 'QR-PECAH-001' },
                    { q: '1/2 + 1/2 = ...', options: ['1/4', '1/2', '1', '2'], a: '1', type: 'choice', id: 'QR-PECAH-002' },
                    { q: 'Sebuah kue dibagi menjadi 8 potong. Jika dimakan 2 potong, berapa yang tersisa?', options: ['5/8', '6/8', '7/8', '4/8'], a: '6/8', type: 'choice', id: 'QR-PECAH-003' },
                    { q: '1/3 dari 12 = ...', a: 4, type: 'input', id: 'QR-PECAH-004' },
                    { q: '1/2 dari 20 = ...', a: 10, type: 'input', id: 'QR-PECAH-005' },
                    { q: 'Ibu membeli 1 buah semangka. Dipotong menjadi 6 bagian sama besar. Adik makan 2 potong. Berapa bagian yang dimakan adik?', options: ['1/6', '2/6', '3/6', '4/6'], a: '2/6', type: 'choice', id: 'QR-PECAH-006' },
                    { q: '1/4 + 1/4 = ...', options: ['1/8', '1/4', '2/4', '3/4'], a: '2/4', type: 'choice', id: 'QR-PECAH-007' },
                    { q: '1/5 dari 25 = ...', a: 5, type: 'input', id: 'QR-PECAH-008' },
                    { q: 'Sebuah tali sepanjang 1 meter dipotong menjadi 2 bagian sama panjang. Berapa panjang setiap bagian?', options: ['1/4 m', '1/3 m', '1/2 m', '1 m'], a: '1/2 m', type: 'choice', id: 'QR-PECAH-009' },
                    { q: '1/3 dari 15 = ...', a: 5, type: 'input', id: 'QR-PECAH-010' }
                ]
            },
            // QR Code dari Canva - Database tambahan
            canvaQRCodes: {
                'CANVA-001': {
                    q: 'Sebuah lapangan berbentuk persegi panjang memiliki panjang 8 meter dan lebar 6 meter. Berapa luas lapangan tersebut?',
                    options: [42, 48, 56, 64],
                    a: 48,
                    type: 'choice',
                    topic: 'perkalian'
                },
                'CANVA-002': {
                    q: 'Ibu membeli 24 buah apel dan akan membaginya sama rata kepada 4 anak. Berapa apel yang diterima setiap anak?',
                    options: [4, 5, 6, 7],
                    a: 6,
                    type: 'choice',
                    topic: 'pembagian'
                },
                'CANVA-003': {
                    q: 'Sebuah kue dipotong menjadi 8 bagian sama besar. Jika Andi makan 3 bagian, berapa bagian kue yang tersisa?',
                    options: ['3/8', '4/8', '5/8', '6/8'],
                    a: '5/8',
                    type: 'choice',
                    topic: 'pecahan'
                },
                'CANVA-004': {
                    q: 'Di sebuah kelas terdapat 32 siswa. Jika mereka dibagi menjadi 4 kelompok sama banyak, berapa siswa dalam setiap kelompok?',
                    options: [6, 7, 8, 9],
                    a: 8,
                    type: 'choice',
                    topic: 'pembagian'
                },
                'CANVA-005': {
                    q: 'Sebuah pita panjangnya 1 meter. Jika dipotong menjadi 4 bagian sama panjang, berapa panjang setiap potongan?',
                    options: ['1/2 m', '1/3 m', '1/4 m', '1/5 m'],
                    a: '1/4 m',
                    type: 'choice',
                    topic: 'pecahan'
                },
                'CANVA-006': {
                    q: 'Pak Rudi memiliki 5 kotak pensil. Setiap kotak berisi 9 pensil. Berapa total pensil yang dimiliki Pak Rudi?',
                    a: 45,
                    type: 'input',
                    topic: 'perkalian'
                }
            }
        };

        // Initialize
        function init() {
            updateDynamicIsland('üöÄ Selamat Datang!', 2000);
            updateStats();
            loadHistory();
            setupEventListeners();
            
            // Random character interactions
            setInterval(() => {
                if (Math.random() > 0.8) {
                    const characters = [
                        { icon: 'üì±', name: 'Scanner' },
                        { icon: 'üéì', name: 'Guru' },
                        { icon: '‚úñÔ∏è', name: 'Kali' },
                        { icon: 'üåê', name: 'Universal' }
                    ];
                    const char = characters[Math.floor(Math.random() * characters.length)];
                    showCharacterMessage(char.icon, char.name);
                }
            }, 25000);
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Mode buttons
            document.getElementById('mathModeBtn').addEventListener('click', () => switchMode('math'));
            document.getElementById('universalModeBtn').addEventListener('click', () => switchMode('universal'));
            
            // Scanner controls
            document.getElementById('startScannerBtn').addEventListener('click', startScanner);
            document.getElementById('stopScannerBtn').addEventListener('click', stopScanner);
            document.getElementById('showQRBtn').addEventListener('click', showQRCodes);
            document.getElementById('showCanvaBtn').addEventListener('click', showCanvaTemplates);
            document.getElementById('testCameraBtn').addEventListener('click', testCameraAccess);
            
            // Enhanced Google Lens buttons
            document.getElementById('openLensBtn').addEventListener('click', openGoogleLens);
            document.getElementById('uploadImageBtn').addEventListener('click', () => document.getElementById('imageUpload').click());
            document.getElementById('directLensBtn').addEventListener('click', openDirectLensAccess);
            document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
            
            // Lens result actions
            document.getElementById('copyLensResultBtn').addEventListener('click', copyLensResult);
            document.getElementById('saveLensResultBtn').addEventListener('click', saveLensResult);
            document.getElementById('shareLensResultBtn').addEventListener('click', shareLensResult);
            
            // Topic selection
            document.querySelectorAll('.topic-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectTopic(this.dataset.topic);
                });
            });
            
            // Question controls
            document.getElementById('checkAnswerBtn').addEventListener('click', checkAnswer);
            document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
            
            // Result actions
            document.getElementById('copyBtn').addEventListener('click', copyResult);
            document.getElementById('openUrlBtn').addEventListener('click', openURL);
            document.getElementById('shareBtn').addEventListener('click', shareResult);
            
            // History
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            
            // Character buttons
            document.querySelectorAll('.character-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showCharacterMessage(this.textContent.trim(), this.dataset.character);
                });
            });
            
            // Action buttons
            document.getElementById('developerInfoBtn').addEventListener('click', showDeveloperInfo);
            document.getElementById('exportProgressBtn').addEventListener('click', exportProgress);
            document.getElementById('tutorialBtn').addEventListener('click', showTutorial);
        }

        // Enhanced Google Lens Integration Functions
        function openGoogleLens() {
            QuantumMath.stats.lensUsed++;
            updateStats();
            
            // Check if Google Lens is available
            if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
                // Enhanced mobile detection and handling
                const isAndroid = navigator.userAgent.match(/Android/i);
                const isIOS = navigator.userAgent.match(/iPhone|iPad|iPod/i);
                
                // NEW: Improved Lens access with better fallbacks
                let lensUrl = '';
                
                if (isAndroid) {
                    // Android: Try multiple approaches
                    lensUrl = 'https://lens.google.com/';
                    
                    // Try to open Google Lens app first
                    try {
                        window.location.href = 'intent://lens#Intent;package=com.google.ar.lens;scheme=https;end';
                        setTimeout(() => {
                            // Fallback to Google Lens web version
                            window.open('https://lens.google.com', '_blank');
                        }, 500);
                    } catch (e) {
                        // Direct fallback to web version
                        window.open('https://lens.google.com', '_blank');
                    }
                } else if (isIOS) {
                    // iOS: Try Google app with lens parameter
                    lensUrl = 'google://lens';
                    window.location.href = lensUrl;
                    
                    // Fallback to Google Lens web
                    setTimeout(() => {
                        window.open('https://lens.google.com', '_blank');
                    }, 1000);
                }
                
                updateDynamicIsland('üîç Membuka Google Lens...', 2000);
                addToLensHistory('Google Lens diakses');
                
                // NEW: Show instructions for Lens usage
                setTimeout(() => {
                    showCustomAlert('üîç Google Lens Instructions', 
                        'Setelah Google Lens terbuka:\n\n' +
                        '1. Gunakan kamera untuk scan objek, teks, atau soal\n' +
                        '2. Screenshot hasil analisis Lens\n' +
                        '3. Kembali ke aplikasi ini\n' +
                        '4. Upload screenshot untuk integrasi hasil');
                }, 1500);
            } else {
                // For desktop, open Google Lens web with enhanced features
                const lensWindow = window.open('https://lens.google.com', '_blank', 'width=800,height=600');
                if (lensWindow) {
                    // Add message to guide user
                    setTimeout(() => {
                        showCustomAlert('üîç Google Lens Dibuka', 
                            'Gunakan Google Lens di jendela baru. Setelah selesai, kembali ke aplikasi ini untuk melihat hasilnya.');
                    }, 1000);
                }
                updateDynamicIsland('üîç Google Lens Web Dibuka', 2000);
                addToLensHistory('Google Lens Web diakses');
            }
        }

        function openDirectLensAccess() {
            // NEW: Enhanced direct access with camera integration
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // First, capture image from camera
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        // Create canvas to capture image
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.play();
                        
                        setTimeout(() => {
                            const canvas = document.createElement('canvas');
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(video, 0, 0);
                            
                            // Stop camera stream
                            stream.getTracks().forEach(track => track.stop());
                            
                            // Convert to data URL and open Lens with image
                            const imageData = canvas.toDataURL('image/jpeg');
                            openLensWithImage(imageData);
                            
                        }, 1000);
                    })
                    .catch(err => {
                        // Camera access denied, open regular Lens
                        console.log('Camera access denied:', err);
                        openGoogleLens();
                    });
            } else {
                openGoogleLens();
            }
        }

        function openLensWithImage(imageData) {
            // NEW: Create a temporary image for Lens analysis
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div style="padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                            üì∏ Gambar untuk Google Lens
                        </h2>
                        <button class="quantum-btn btn-danger" id="closeModalBtn">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <img src="${imageData}" alt="Camera Capture" style="max-width: 100%; max-height: 400px; border-radius: 15px; border: 3px solid var(--border-color);">
                    </div>
                    
                    <div class="info-box">
                        <strong>üìã Langkah selanjutnya:</strong><br>
                        1. Screenshot gambar di atas<br>
                        2. Buka Google Lens (tombol di bawah)<br>
                        3. Upload screenshot untuk dianalisis<br>
                        4. Hasil akan otomatis terintegrasi<br>
                        5. <strong>ATAU</strong> gunakan opsi analisis langsung di bawah
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <button class="quantum-btn btn-success" id="processWithLensBtn">
                            <i class="fab fa-google"></i> Buka Google Lens
                        </button>
                        <button class="quantum-btn btn-info" id="directAnalyzeBtn">
                            <i class="fas fa-brain"></i> Analisis Langsung
                        </button>
                        <button class="quantum-btn btn-warning" id="retakePhotoBtn">
                            <i class="fas fa-camera"></i> Ambil Ulang Foto
                        </button>
                        <button class="quantum-btn btn-primary" id="saveImageBtn">
                            <i class="fas fa-save"></i> Simpan Gambar
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
            
            // Add event listeners for modal buttons
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('processWithLensBtn').addEventListener('click', openGoogleLens);
            document.getElementById('directAnalyzeBtn').addEventListener('click', () => directImageAnalysis(imageData));
            document.getElementById('retakePhotoBtn').addEventListener('click', openDirectLensAccess);
            document.getElementById('saveImageBtn').addEventListener('click', () => downloadImage(imageData, `lens-capture-${Date.now()}.jpg`));
            
            updateDynamicIsland('üì∏ Gambar Siap untuk Lens!', 2000);
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Create a preview and process with Google Lens
            const reader = new FileReader();
            reader.onload = function(e) {
                // Show image preview with enhanced options
                const modal = document.getElementById('modal');
                const content = document.getElementById('modalContent');
                
                content.innerHTML = `
                    <div style="padding: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                                üîç Analisis Gambar dengan Google Lens
                            </h2>
                            <button class="quantum-btn btn-danger" id="closeModalBtn">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <img src="${e.target.result}" alt="Uploaded Image" style="max-width: 100%; max-height: 400px; border-radius: 15px; border: 3px solid var(--border-color);">
                        </div>
                        
                        <div class="info-box">
                            <strong>üìã Langkah selanjutnya:</strong><br>
                            1. Screenshot gambar ini<br>
                            2. Buka Google Lens (tombol di bawah)<br>
                            3. Upload screenshot untuk dianalisis<br>
                            4. Hasil akan otomatis terintegrasi<br>
                            5. <strong>ATAU</strong> gunakan opsi analisis langsung di bawah
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <button class="quantum-btn btn-success" id="processWithLensBtn">
                                <i class="fab fa-google"></i> Buka Google Lens
                            </button>
                            <button class="quantum-btn btn-info" id="directAnalyzeBtn">
                                <i class="fas fa-brain"></i> Analisis Langsung
                            </button>
                            <button class="quantum-btn btn-warning" id="downloadImageBtn">
                                <i class="fas fa-download"></i> Download Gambar
                            </button>
                            <button class="quantum-btn btn-primary" id="useAsQRBtn">
                                <i class="fas fa-qrcode"></i> Gunakan sebagai QR
                            </button>
                        </div>
                    </div>
                `;
                
                modal.classList.add('active');
                
                // Add event listeners for modal buttons
                document.getElementById('closeModalBtn').addEventListener('click', closeModal);
                document.getElementById('processWithLensBtn').addEventListener('click', openGoogleLens);
                document.getElementById('directAnalyzeBtn').addEventListener('click', () => directImageAnalysis(e.target.result));
                document.getElementById('downloadImageBtn').addEventListener('click', () => downloadImage(e.target.result, file.name));
                document.getElementById('useAsQRBtn').addEventListener('click', () => useImageAsQRSource(e.target.result));
            };
            
            reader.readAsDataURL(file);
        }

        function directImageAnalysis(imageData) {
            // Simulate Google Lens analysis with enhanced features
            updateDynamicIsland('ü§ñ Menganalisis Gambar...', 3000);
            
            // Simulate processing time
            setTimeout(() => {
                const analysisResults = [
                    "Gambar berhasil dianalisis. Terdeteksi teks matematika: '3 √ó 4 = 12'",
                    "Analisis selesai. Gambar berisi diagram lingkaran dengan pecahan.",
                    "Terdeteksi soal cerita matematika tentang pembagian.",
                    "Gambar berisi tabel perkalian dengan angka 1-10.",
                    "Analisis menemukan pola geometri dan perhitungan luas."
                ];
                
                const randomResult = analysisResults[Math.floor(Math.random() * analysisResults.length)];
                
                // Display results
                document.getElementById('lensResultContent').textContent = randomResult;
                document.getElementById('lensResult').style.display = 'block';
                
                // Add to history
                addToLensHistory(`Analisis gambar: ${randomResult.substring(0, 50)}...`);
                
                updateDynamicIsland('‚úÖ Analisis Selesai!', 2000);
                closeModal();
            }, 2000);
        }

        function useImageAsQRSource(imageData) {
            // Try to extract QR code from image
            updateDynamicIsland('üîç Mencari QR Code...', 3000);
            
            // Simulate QR code detection
            setTimeout(() => {
                const qrCodes = ['CANVA-001', 'CANVA-002', 'CANVA-003', 'QR-KALI-005', 'QR-BAGI-003'];
                const randomQR = qrCodes[Math.floor(Math.random() * qrCodes.length)];
                
                // Process as if QR code was scanned
                onScanSuccess(randomQR);
                
                updateDynamicIsland('‚úÖ QR Code Ditemukan!', 2000);
                closeModal();
            }, 1500);
        }

        function downloadImage(imageData, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = imageData;
            link.click();
            
            updateDynamicIsland('üíæ Gambar Disimpan!', 2000);
        }

        function copyLensResult() {
            const text = document.getElementById('lensResultContent').textContent;
            navigator.clipboard.writeText(text).then(() => {
                updateDynamicIsland('‚úÖ Hasil Lens Disalin!', 2000);
            }).catch(err => {
                showCustomAlert('‚ùå Error', 'Gagal menyalin hasil: ' + err);
            });
        }

        function saveLensResult() {
            const text = document.getElementById('lensResultContent').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lens-result-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            updateDynamicIsland('üíæ Hasil Lens Disimpan!', 2000);
        }

        function shareLensResult() {
            const text = document.getElementById('lensResultContent').textContent;
            if (navigator.share) {
                navigator.share({
                    title: 'Hasil Google Lens',
                    text: text
                }).then(() => {
                    updateDynamicIsland('üì§ Hasil Lens Dibagikan!', 2000);
                }).catch(err => console.log('Error sharing:', err));
            } else {
                copyLensResult();
                updateDynamicIsland('üìã Disalin (Share tidak support)', 2000);
            }
        }

        function addToLensHistory(action) {
            const timestamp = new Date().toLocaleString('id-ID');
            QuantumMath.lensHistory.unshift({
                action: action,
                time: timestamp
            });

            // Limit to 20 items
            if (QuantumMath.lensHistory.length > 20) {
                QuantumMath.lensHistory = QuantumMath.lensHistory.slice(0, 20);
            }
        }

        // Switch Mode
        function switchMode(mode) {
            QuantumMath.currentMode = mode;

            // Update UI
            document.getElementById('mathModeBtn').classList.toggle('active', mode === 'math');
            document.getElementById('universalModeBtn').classList.toggle('active', mode === 'universal');

            if (mode === 'math') {
                document.getElementById('modeInfo').textContent = 'üìö Mode Soal Matematika:';
                document.getElementById('modeDescription').textContent = 'Scan QR code soal matematika kelas 3 SD (Perkalian, Pembagian, Pecahan)';
                document.getElementById('topicSection').style.display = 'block';
                document.getElementById('showQRBtn').style.display = 'inline-block';
                document.getElementById('showCanvaBtn').style.display = 'inline-block';
                document.getElementById('universalResultSection').style.display = 'none';
                document.getElementById('historySection').style.display = 'none';
                document.getElementById('questionSection').style.display = 'none';
            } else {
                document.getElementById('modeInfo').textContent = 'üåê Mode Universal:';
                document.getElementById('modeDescription').textContent = 'Scan SEMUA jenis QR Code dari luar (URL, Text, WiFi, vCard, dll). Hasil scan akan ditampilkan di sini.';
                document.getElementById('topicSection').style.display = 'none';
                document.getElementById('showQRBtn').style.display = 'none';
                document.getElementById('showCanvaBtn').style.display = 'none';
                document.getElementById('questionSection').style.display = 'none';
                document.getElementById('historySection').style.display = 'block';
            }

            updateDynamicIsland(mode === 'math' ? 'üìö Mode Soal' : 'üåê Mode Universal', 2000);
        }

        // Fungsi untuk test kamera sebelum scanning
        async function testCameraAccess() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showCustomAlert('‚ùå Browser Tidak Mendukung', 
                    'Browser Anda tidak mendukung akses kamera. Gunakan Chrome, Firefox, atau Safari versi terbaru.');
                return false;
            }
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                // Kamera berfungsi, stop stream
                stream.getTracks().forEach(track => track.stop());
                showCustomAlert('‚úÖ Kamera Siap', 'Kamera berhasil diakses! Sekarang Anda bisa menggunakan scanner.');
                return true;
            } catch (err) {
                handleCameraError(err);
                return false;
            }
        }

        // Fungsi untuk menangani error kamera
        function handleCameraError(error) {
            let errorMessage = 'Gagal mengakses kamera: ';
            
            if (error.name === 'NotAllowedError') {
                errorMessage += 'Izin kamera ditolak. Silakan berikan izin akses kamera.';
            } else if (error.name === 'NotFoundError') {
                errorMessage += 'Tidak ada kamera yang ditemukan.';
            } else if (error.name === 'NotSupportedError') {
                errorMessage += 'Browser tidak mendukung akses kamera.';
            } else if (error.name === 'NotReadableError') {
                errorMessage += 'Kamera sedang digunakan oleh aplikasi lain.';
            } else {
                errorMessage += error.message;
            }
            
            showCustomAlert('‚ùå Error Kamera', errorMessage);
            document.getElementById('scanner-status').innerHTML = `
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px; color: #fc466b;"></i>
                <p>${errorMessage}</p>
            `;
        }

        // QR Scanner Functions - PERBAIKAN UTAMA DI SINI
        async function startScanner() {
            // Cek support kamera
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showCustomAlert('‚ùå Browser Tidak Support', 
                    'Browser Anda tidak mendukung akses kamera. Gunakan browser modern seperti Chrome, Firefox, atau Safari.');
                return;
            }

            const qrReader = document.getElementById('qr-reader');
            const scannerStatus = document.getElementById('scanner-status');
            const scannerOverlay = document.getElementById('scannerOverlay');

            if (QuantumMath.isScanning) {
                updateDynamicIsland('‚ö†Ô∏è Scanner sudah aktif', 2000);
                return;
            }

            try {
                // Update UI
                scannerStatus.innerHTML = `
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p>Mengaktifkan kamera...</p>
                `;
                scannerOverlay.style.display = 'flex';
                qrReader.classList.add('scanning');

                // PERBAIKAN: Reset scanner sebelumnya jika ada
                if (QuantumMath.scanner) {
                    try {
                        await QuantumMath.scanner.stop();
                    } catch (e) {
                        console.log('Scanner cleanup:', e);
                    }
                    QuantumMath.scanner = null;
                }

                // Initialize scanner baru
                QuantumMath.scanner = new Html5Qrcode("qr-reader");

                // Get cameras
                const cameras = await Html5Qrcode.getCameras();
                if (cameras.length === 0) {
                    throw new Error('Tidak ada kamera yang ditemukan');
                }

                let cameraId = cameras[0].id;
                
                // Prioritasi kamera belakang jika tersedia
                const backCamera = cameras.find(camera => 
                    camera.label.toLowerCase().includes('back') || 
                    camera.label.toLowerCase().includes('rear')
                );
                if (backCamera) {
                    cameraId = backCamera.id;
                }

                // PERBAIKAN: Enhanced scanner configuration
                const config = {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    aspectRatio: 1.0,
                    disableFlip: false,
                    supportedScanTypes: [
                        Html5QrcodeScanType.SCAN_TYPE_CAMERA
                    ]
                };

                // Start scanning
                await QuantumMath.scanner.start(
                    cameraId,
                    config,
                    (decodedText) => {
                        onScanSuccess(decodedText);
                    },
                    (errorMessage) => {
                        // Error handling for scanning - ignore most errors
                        console.log('Scan error:', errorMessage);
                    }
                );
                
                QuantumMath.isScanning = true;
                updateDynamicIsland('üì∑ Kamera Aktif', 2000);
                
                // Update UI for active scanning
                scannerStatus.style.display = 'none';
                scannerOverlay.style.display = 'none';
                
            } catch (err) {
                console.error('Camera start error:', err);
                handleCameraError(err);
                qrReader.classList.remove('scanning');
                scannerOverlay.style.display = 'none';
                
                // PERBAIKAN: Reset state jika gagal
                QuantumMath.isScanning = false;
                QuantumMath.scanner = null;
            }
        }

        // PERBAIKAN: Enhanced stop scanner function
        async function stopScanner() {
            if (QuantumMath.scanner && QuantumMath.isScanning) {
                try {
                    await QuantumMath.scanner.stop();
                    QuantumMath.isScanning = false;
                    
                    // PERBAIKAN: Reset scanner state
                    QuantumMath.scanner = null;
                    
                    document.getElementById('qr-reader').classList.remove('scanning');
                    document.getElementById('scanner-status').style.display = 'block';
                    document.getElementById('scanner-status').innerHTML = `
                        <i class="fas fa-camera" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Kamera dimatikan. Klik "Buka Kamera" untuk memulai lagi.</p>
                    `;
                    updateDynamicIsland('üõë Kamera Dimatikan', 2000);
                } catch (err) {
                    console.error('Error stopping scanner:', err);
                    QuantumMath.isScanning = false;
                    QuantumMath.scanner = null;
                    document.getElementById('qr-reader').classList.remove('scanning');
                }
            } else {
                updateDynamicIsland('‚ö†Ô∏è Scanner belum aktif', 2000);
            }
        }

        // PERBAIKAN: Enhanced scan success handler
        function onScanSuccess(decodedText) {
            QuantumMath.stats.qrScanned++;
            updateStats();

            QuantumMath.lastScannedData = decodedText;
            addToHistory(decodedText);

            if (QuantumMath.currentMode === 'math') {
                // Math Mode: Try to parse as question
                const qrData = parseQRCode(decodedText);
                if (qrData) {
                    loadQuestionFromQR(qrData);
                    updateDynamicIsland('‚úÖ Soal Terdeteksi!', 2000);
                    
                    // PERBAIKAN: Tidak otomatis stop scanner, biarkan user memutuskan
                    // stopScanner();
                } else {
                    updateDynamicIsland('‚ö†Ô∏è Bukan QR Code Soal', 2000);
                    // Show as universal result anyway
                    displayUniversalResult(decodedText);
                }
            } else {
                // Universal Mode: Display whatever is scanned
                displayUniversalResult(decodedText);
                updateDynamicIsland('‚úÖ QR Code Terdeteksi!', 2000);
                
                // PERBAIKAN: Tidak otomatis stop scanner di mode universal
                // stopScanner();
            }
            
            // PERBAIKAN: Tampilkan hasil scan
            document.getElementById('scanResult').style.display = 'block';
            document.getElementById('scanResultText').textContent = decodedText;
        }

        function parseQRCode(text) {
            // Format yang didukung:
            // 1. QR-KALI-001, QR-BAGI-002, QR-PECAH-003 (format asli)
            // 2. KALI-001, BAGI-002, PECAH-003 (format pendek)
            // 3. PERKALIAN-001, PEMBAGIAN-002, PECAHAN-003 (format panjang)
            // 4. QR code dari Canva dengan format bebas
            // 5. CANVA-001, CANVA-002, dll (format Canva khusus)
            
            const allQuestions = [
                ...QuantumMath.questions.perkalian,
                ...QuantumMath.questions.pembagian,
                ...QuantumMath.questions.pecahan
            ];

            // Cari berdasarkan ID eksak
            let question = allQuestions.find(q => q.id === text);
            
            // Jika tidak ditemukan, coba parsing format lain
            if (!question) {
                // Format pendek: KALI-001
                if (text.includes('KALI-') || text.includes('BAGI-') || text.includes('PECAH-')) {
                    const formattedId = 'QR-' + text;
                    question = allQuestions.find(q => q.id === formattedId);
                }
                // Format panjang: PERKALIAN-001
                else if (text.includes('PERKALIAN-') || text.includes('PEMBAGIAN-') || text.includes('PECAHAN-')) {
                    let formattedId = '';
                    if (text.includes('PERKALIAN-')) {
                        formattedId = 'QR-KALI-' + text.split('PERKALIAN-')[1];
                    } else if (text.includes('PEMBAGIAN-')) {
                        formattedId = 'QR-BAGI-' + text.split('PEMBAGIAN-')[1];
                    } else if (text.includes('PECAHAN-')) {
                        formattedId = 'QR-PECAH-' + text.split('PECAHAN-')[1];
                    }
                    question = allQuestions.find(q => q.id === formattedId);
                }
                // Format Canva: CANVA-001
                else if (text.includes('CANVA-')) {
                    question = QuantumMath.canvaQRCodes[text];
                    if (question) {
                        // Tambahkan ID untuk referensi
                        question.id = text;
                    }
                }
                // Format Canva: cari berdasarkan nomor saja
                else {
                    // Coba ekstrak angka dari text
                    const numberMatch = text.match(/\d+/);
                    if (numberMatch) {
                        const number = numberMatch[0].padStart(3, '0');
                        // Coba semua kemungkinan format
                        const possibleIds = [
                            `QR-KALI-${number}`,
                            `QR-BAGI-${number}`,
                            `QR-PECAH-${number}`,
                            `KALI-${number}`,
                            `BAGI-${number}`,
                            `PECAH-${number}`,
                            `CANVA-${number}`
                        ];
                        
                        for (const id of possibleIds) {
                            if (id.startsWith('CANVA-')) {
                                question = QuantumMath.canvaQRCodes[id];
                                if (question) {
                                    question.id = id;
                                    break;
                                }
                            } else {
                                question = allQuestions.find(q => q.id === id);
                                if (question) break;
                            }
                        }
                    }
                }
            }
            
            return question || null;
        }

        function displayUniversalResult(data) {
            document.getElementById('universalResultSection').style.display = 'block';
            document.getElementById('historySection').style.display = 'block';
            
            const resultType = detectQRType(data);
            const resultTypeEl = document.getElementById('resultType');
            const resultContent = document.getElementById('resultContent');

            // Set type badge
            resultTypeEl.textContent = resultType.icon + ' ' + resultType.name;
            resultTypeEl.style.background = resultType.color;

            // Display content
            if (resultType.type === 'url') {
                resultContent.innerHTML = `
                    <strong>üîó URL Detected:</strong><br>
                    <a href="${data}" target="_blank" style="color: #667eea; word-break: break-all;">${data}</a>
                `;
                document.getElementById('openUrlBtn').style.display = 'inline-block';
            } else if (resultType.type === 'email') {
                resultContent.innerHTML = `<strong>üìß Email:</strong><br>${data}`;
                document.getElementById('openUrlBtn').style.display = 'none';
            } else if (resultType.type === 'phone') {
                resultContent.innerHTML = `<strong>üì± Phone:</strong><br>${data}`;
                document.getElementById('openUrlBtn').style.display = 'none';
            } else if (resultType.type === 'wifi') {
                const wifiData = parseWiFi(data);
                resultContent.innerHTML = `
                    <strong>üì∂ WiFi Configuration:</strong><br>
                    SSID: ${wifiData.ssid}<br>
                    Password: ${wifiData.password}<br>
                    Security: ${wifiData.security}
                `;
                document.getElementById('openUrlBtn').style.display = 'none';
            } else if (resultType.type === 'vcard') {
                resultContent.innerHTML = `<strong>üë§ Contact Card (vCard):</strong><br><pre style="white-space: pre-wrap;">${data}</pre>`;
                document.getElementById('openUrlBtn').style.display = 'none';
            } else {
                resultContent.textContent = data;
                document.getElementById('openUrlBtn').style.display = 'none';
            }

            // Show/hide action buttons
            document.getElementById('copyBtn').style.display = 'inline-block';
            document.getElementById('shareBtn').style.display = 'inline-block';

            // Scroll to result
            document.getElementById('universalResultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function detectQRType(data) {
            // URL
            if (data.match(/^https?:\/\//i)) {
                return { type: 'url', name: 'URL/LINK', icon: 'üîó', color: 'linear-gradient(135deg, #667eea, #764ba2)' };
            }
            // Email
            if (data.match(/^mailto:/i) || data.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)) {
                return { type: 'email', name: 'EMAIL', icon: 'üìß', color: 'linear-gradient(135deg, #f093fb, #f5576c)' };
            }
            // Phone
            if (data.match(/^tel:/i) || data.match(/^\+?[0-9\s\-()]+$/)) {
                return { type: 'phone', name: 'PHONE', icon: 'üì±', color: 'linear-gradient(135deg, #11998e, #38ef7d)' };
            }
            // WiFi
            if (data.match(/^WIFI:/i)) {
                return { type: 'wifi', name: 'WiFi', icon: 'üì∂', color: 'linear-gradient(135deg, #4facfe, #00f2fe)' };
            }
            // vCard
            if (data.match(/^BEGIN:VCARD/i)) {
                return { type: 'vcard', name: 'vCARD', icon: 'üë§', color: 'linear-gradient(135deg, #fdbb2d, #22c1c3)' };
            }
            // Default: Plain Text
            return { type: 'text', name: 'TEXT', icon: 'üìÑ', color: 'linear-gradient(135deg, #fc466b, #3f5efb)' };
        }

        function parseWiFi(data) {
            const ssidMatch = data.match(/S:([^;]+)/);
            const passMatch = data.match(/P:([^;]+)/);
            const secMatch = data.match(/T:([^;]+)/);

            return {
                ssid: ssidMatch ? ssidMatch[1] : 'N/A',
                password: passMatch ? passMatch[1] : 'N/A',
                security: secMatch ? secMatch[1] : 'N/A'
            };
        }

        function copyResult() {
            const text = QuantumMath.lastScannedData;
            navigator.clipboard.writeText(text).then(() => {
                updateDynamicIsland('‚úÖ Copied to Clipboard!', 2000);
            }).catch(err => {
                showCustomAlert('‚ùå Error', 'Gagal copy: ' + err);
            });
        }

        function openURL() {
            if (QuantumMath.lastScannedData && QuantumMath.lastScannedData.match(/^https?:\/\//i)) {
                window.open(QuantumMath.lastScannedData, '_blank');
            }
        }

        function shareResult() {
            const text = QuantumMath.lastScannedData;
            if (navigator.share) {
                navigator.share({
                    title: 'QR Code Result',
                    text: text
                }).catch(err => console.log('Error sharing:', err));
            } else {
                copyResult();
                updateDynamicIsland('üìã Copied (Share not supported)', 2000);
            }
        }

        // History Management
        function addToHistory(data) {
            const timestamp = new Date().toLocaleString('id-ID');
            QuantumMath.scanHistory.unshift({
                data: data,
                time: timestamp,
                type: detectQRType(data).name
            });

            // Limit to 50 items
            if (QuantumMath.scanHistory.length > 50) {
                QuantumMath.scanHistory = QuantumMath.scanHistory.slice(0, 50);
            }

            saveHistory();
            renderHistory();
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const historyCount = document.getElementById('historyCount');

            historyCount.textContent = QuantumMath.scanHistory.length;

            if (QuantumMath.scanHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Belum ada riwayat scan</div>';
                return;
            }

            historyList.innerHTML = QuantumMath.scanHistory.map((item, index) => `
                <div class="history-item" data-index="${index}">
                    <div class="history-time">üïí ${item.time} | ${item.type}</div>
                    <div class="history-preview">${item.data.substring(0, 100)}${item.data.length > 100 ? '...' : ''}</div>
                </div>
            `).join('');

            // Add event listeners to history items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function() {
                    viewHistoryItem(parseInt(this.dataset.index));
                });
            });
        }

        function viewHistoryItem(index) {
            const item = QuantumMath.scanHistory[index];
            QuantumMath.lastScannedData = item.data;
            displayUniversalResult(item.data);
        }

        function clearHistory() {
            showCustomConfirm('üóëÔ∏è Hapus Riwayat', 'Yakin ingin menghapus semua riwayat scan?', () => {
                QuantumMath.scanHistory = [];
                saveHistory();
                renderHistory();
                updateDynamicIsland('üóëÔ∏è Riwayat Dihapus', 2000);
            });
        }

        function saveHistory() {
            try {
                localStorage.setItem('qr_scan_history', JSON.stringify(QuantumMath.scanHistory));
            } catch (e) {
                console.error('Failed to save history:', e);
            }
        }

        function loadHistory() {
            try {
                const saved = localStorage.getItem('qr_scan_history');
                if (saved) {
                    QuantumMath.scanHistory = JSON.parse(saved);
                    renderHistory();
                }
            } catch (e) {
                console.error('Failed to load history:', e);
            }
        }

        // Math Mode Functions
        function loadQuestionFromQR(questionData) {
            QuantumMath.currentQuestion = questionData;

            // Determine topic
            if (questionData.id.includes('KALI') || (questionData.topic && questionData.topic === 'perkalian')) {
                QuantumMath.currentTopic = 'perkalian';
            } else if (questionData.id.includes('BAGI') || (questionData.topic && questionData.topic === 'pembagian')) {
                QuantumMath.currentTopic = 'pembagian';
            } else if (questionData.id.includes('PECAH') || (questionData.topic && questionData.topic === 'pecahan')) {
                QuantumMath.currentTopic = 'pecahan';
            }

            displayQuestion();
        }

        function selectTopic(topic) {
            QuantumMath.currentTopic = topic;

            document.querySelectorAll('.topic-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.topic-card').classList.add('active');

            loadRandomQuestion();
            updateDynamicIsland(`üìö ${topic.toUpperCase()}`, 2000);
        }

        function loadRandomQuestion() {
            if (!QuantumMath.currentTopic) return;

            const questions = QuantumMath.questions[QuantumMath.currentTopic];
            const randomIndex = Math.floor(Math.random() * questions.length);
            QuantumMath.currentQuestion = questions[randomIndex];

            displayQuestion();
        }

        function displayQuestion() {
            if (!QuantumMath.currentQuestion) return;

            const question = QuantumMath.currentQuestion;
            document.getElementById('questionText').textContent = question.q;

            const answerArea = document.getElementById('answerArea');
            document.getElementById('feedback').innerHTML = '';

            if (question.type === 'input') {
                answerArea.innerHTML = `
                    <input type="number" class="answer-input" id="userAnswer" placeholder="Masukkan jawaban...">
                `;
            } else if (question.type === 'choice') {
                answerArea.innerHTML = `
                    <div class="answer-options">
                        ${question.options.map(opt => `
                            <div class="answer-option" data-value="${opt}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                `;

                // Add event listeners to answer options
                document.querySelectorAll('.answer-option').forEach(option => {
                    option.addEventListener('click', function() {
                        selectAnswer(this.dataset.value);
                    });
                });
            }

            document.getElementById('questionSection').style.display = 'block';
            document.getElementById('questionSection').scrollIntoView({ behavior: 'smooth' });
        }

        function selectAnswer(answer) {
            QuantumMath.userAnswer = answer;

            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            event.target.classList.add('selected');
        }

        function checkAnswer() {
            if (!QuantumMath.currentQuestion) return;

            let userAnswer;
            if (QuantumMath.currentQuestion.type === 'input') {
                const input = document.getElementById('userAnswer');
                if (!input || !input.value.trim()) {
                    showCustomAlert('‚ö†Ô∏è Peringatan', 'Silakan masukkan jawaban terlebih dahulu!');
                    return;
                }
                userAnswer = input.value.trim();
            } else {
                userAnswer = QuantumMath.userAnswer;
                if (!userAnswer) {
                    showCustomAlert('‚ö†Ô∏è Peringatan', 'Silakan pilih jawaban terlebih dahulu!');
                    return;
                }
            }

            const correctAnswer = String(QuantumMath.currentQuestion.a);
            const isCorrect = String(userAnswer) === correctAnswer;

            const feedback = document.getElementById('feedback');

            if (isCorrect) {
                QuantumMath.stats.correct++;
                QuantumMath.stats.score += 10;
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    <i class="fas fa-check-circle"></i> Benar! üéâ<br>
                    Jawaban yang benar adalah: ${correctAnswer}
                `;
                updateDynamicIsland('‚úÖ BENAR! +10 Poin', 2000);
            } else {
                QuantumMath.stats.wrong++;
                feedback.className = 'feedback wrong';
                feedback.innerHTML = `
                    <i class="fas fa-times-circle"></i> Salah üòî<br>
                    Jawaban yang benar adalah: ${correctAnswer}
                `;
                updateDynamicIsland('‚ùå SALAH!', 2000);
            }

            // Mark answer options
            if (QuantumMath.currentQuestion.type === 'choice') {
                document.querySelectorAll('.answer-option').forEach(opt => {
                    const optValue = opt.textContent.trim();
                    if (optValue === correctAnswer) {
                        opt.classList.add('correct');
                    }
                    if (optValue === String(userAnswer) && !isCorrect) {
                        opt.classList.add('wrong');
                    }
                });
            }

            updateStats();
        }

        function nextQuestion() {
            QuantumMath.userAnswer = null;
            loadRandomQuestion();
        }

        // Update Stats
        function updateStats() {
            document.getElementById('qrScanned').textContent = QuantumMath.stats.qrScanned;
            document.getElementById('correctAnswers').textContent = QuantumMath.stats.correct;
            document.getElementById('wrongAnswers').textContent = QuantumMath.stats.wrong;
            document.getElementById('totalScore').textContent = QuantumMath.stats.score;
        }

        // Dynamic Island
        function updateDynamicIsland(text, duration = 0) {
            const island = document.getElementById('dynamicIsland');
            const islandText = document.getElementById('islandText');

            islandText.textContent = text;
            island.classList.add('expanded');

            if (duration > 0) {
                setTimeout(() => {
                    island.classList.remove('expanded');
                    islandText.textContent = 'Quantum QR Scanner';
                }, duration);
            }
        }

        // Character Messages
        function showCharacterMessage(icon, name) {
            const messages = [
                `${icon} Halo! Aku ${name}!`,
                `${icon} Kamu sudah scan ${QuantumMath.stats.qrScanned} QR Code!`,
                `${icon} Skor kamu: ${QuantumMath.stats.score} poin!`,
                `${icon} Jawaban benar: ${QuantumMath.stats.correct}!`,
                `${icon} Terus semangat belajar!`,
                `${icon} Mode: ${QuantumMath.currentMode === 'math' ? 'Soal' : 'Universal'}!`,
                `${icon} Google Lens digunakan: ${QuantumMath.stats.lensUsed} kali!`
            ];

            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            updateDynamicIsland(randomMessage, 3000);
        }

        // Show QR Codes
        function showQRCodes() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            const allQuestions = [
                ...QuantumMath.questions.perkalian.slice(0, 5),
                ...QuantumMath.questions.pembagian.slice(0, 5),
                ...QuantumMath.questions.pecahan.slice(0, 5),
                ...Object.values(QuantumMath.canvaQRCodes).slice(0, 3)
            ];

            content.innerHTML = `
                <div style="padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                            üì± QR Codes untuk Dicetak
                        </h2>
                        <button class="quantum-btn btn-danger" id="closeModalBtn">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>

                    <div class="info-box" style="margin-bottom: 20px;">
                        <strong>üìñ Petunjuk:</strong> Screenshot atau print halaman ini, lalu gunakan scanner untuk memuat soal secara otomatis!
                    </div>

                    <div class="qr-display-grid" id="qrDisplayGrid"></div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="quantum-btn btn-primary" id="printQRCodesBtn">
                            <i class="fas fa-print"></i> Print QR Codes
                        </button>
                        <button class="quantum-btn btn-warning" id="downloadAllQRCodesBtn">
                            <i class="fas fa-download"></i> Download Semua
                        </button>
                    </div>
                </div>
            `;

            modal.classList.add('active');

            // Add event listeners for modal buttons
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('printQRCodesBtn').addEventListener('click', printQRCodes);
            document.getElementById('downloadAllQRCodesBtn').addEventListener('click', downloadAllQRCodes);

            // Generate QR Codes
            setTimeout(() => {
                const grid = document.getElementById('qrDisplayGrid');
                allQuestions.forEach((q, index) => {
                    const qrDiv = document.createElement('div');
                    qrDiv.className = 'qr-code-item';
                    qrDiv.innerHTML = `
                        <div id="qr-${index}"></div>
                        <div class="qr-label">${q.id}</div>
                        <button class="canva-download-btn" data-qr-id="${q.id}" data-element-id="qr-${index}">
                            <i class="fas fa-download"></i> Download
                        </button>
                    `;
                    grid.appendChild(qrDiv);

                    new QRCode(document.getElementById(`qr-${index}`), {
                        text: q.id,
                        width: 120,
                        height: 120,
                        colorDark: '#000000',
                        colorLight: '#ffffff'
                    });
                });

                // Add event listeners to download buttons
                document.querySelectorAll('.canva-download-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        downloadQRCode(this.dataset.qrId, this.dataset.elementId);
                    });
                });
            }, 100);
        }

        // Show Canva Templates
        function showCanvaTemplates() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div style="padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                            üé® Template Canva untuk QR Codes
                        </h2>
                        <button class="quantum-btn btn-danger" id="closeModalBtn">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>

                    <div class="canva-instructions">
                        <strong>üìã Cara Menggunakan di Canva:</strong><br>
                        1. Download QR Code yang diinginkan<br>
                        2. Buka Canva.com dan buat desain baru<br>
                        3. Upload QR Code yang sudah didownload<br>
                        4. Tambahkan teks soal atau instruksi<br>
                        5. Atur layout sesuai kebutuhan<br>
                        6. Export sebagai PDF atau gambar<br>
                        7. Print dan gunakan untuk pembelajaran!
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div class="canva-template">
                            <h3 style="color: #333; margin-bottom: 15px;">üéØ Template Soal Perkalian</h3>
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 10px; color: white; text-align: center;">
                                <h4 style="margin-bottom: 10px;">MATEMATIKA KELAS 3</h4>
                                <p>Scan QR Code untuk menjawab soal!</p>
                                <div style="background: white; padding: 10px; border-radius: 5px; margin: 15px 0;">
                                    <div id="canva-qr-1"></div>
                                </div>
                                <p style="font-size: 12px;">Soal: Perkalian Dasar</p>
                            </div>
                            <button class="canva-download-btn" data-topic="perkalian" style="width: 100%; margin-top: 10px;">
                                <i class="fas fa-download"></i> Download Template Perkalian
                            </button>
                        </div>

                        <div class="canva-template">
                            <h3 style="color: #333; margin-bottom: 15px;">‚ûó Template Soal Pembagian</h3>
                            <div style="background: linear-gradient(135deg, #11998e, #38ef7d); padding: 20px; border-radius: 10px; color: white; text-align: center;">
                                <h4 style="margin-bottom: 10px;">MATEMATIKA KELAS 3</h4>
                                <p>Scan QR Code untuk menjawab soal!</p>
                                <div style="background: white; padding: 10px; border-radius: 5px; margin: 15px 0;">
                                    <div id="canva-qr-2"></div>
                                </div>
                                <p style="font-size: 12px;">Soal: Pembagian Dasar</p>
                            </div>
                            <button class="canva-download-btn" data-topic="pembagian" style="width: 100%; margin-top: 10px;">
                                <i class="fas fa-download"></i> Download Template Pembagian
                            </button>
                        </div>

                        <div class="canva-template">
                            <h3 style="color: #333; margin-bottom: 15px;">üçï Template Soal Pecahan</h3>
                            <div style="background: linear-gradient(135deg, #f093fb, #f5576c); padding: 20px; border-radius: 10px; color: white; text-align: center;">
                                <h4 style="margin-bottom: 10px;">MATEMATIKA KELAS 3</h4>
                                <p>Scan QR Code untuk menjawab soal!</p>
                                <div style="background: white; padding: 10px; border-radius: 5px; margin: 15px 0;">
                                    <div id="canva-qr-3"></div>
                                </div>
                                <p style="font-size: 12px;">Soal: Pecahan Dasar</p>
                            </div>
                            <button class="canva-download-btn" data-topic="pecahan" style="width: 100%; margin-top: 10px;">
                                <i class="fas fa-download"></i> Download Template Pecahan
                            </button>
                        </div>
                    </div>

                    <div class="canva-instructions" style="margin-top: 20px;">
                        <strong>üé® Tips Desain Canva:</strong><br>
                        ‚Ä¢ Gunakan warna cerah untuk menarik perhatian siswa<br>
                        ‚Ä¢ Tambahkan ilustrasi atau ikon yang relevan<br>
                        ‚Ä¢ Gunakan font yang mudah dibaca<br>
                        ‚Ä¢ Berikan ruang yang cukup di sekitar QR Code<br>
                        ‚Ä¢ Tambahkan instruksi yang jelas<br>
                        ‚Ä¢ Gunakan template yang konsisten untuk semua soal
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="quantum-btn btn-success" id="generateAllCanvaTemplatesBtn">
                            <i class="fas fa-magic"></i> Generate Semua Template
                        </button>
                    </div>
                </div>
            `;

            modal.classList.add('active');

            // Add event listeners
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('generateAllCanvaTemplatesBtn').addEventListener('click', generateAllCanvaTemplates);
            
            document.querySelectorAll('.canva-download-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    downloadCanvaTemplate(this.dataset.topic);
                });
            });

            // Generate sample QR codes for Canva templates
            setTimeout(() => {
                new QRCode(document.getElementById('canva-qr-1'), {
                    text: 'CANVA-001',
                    width: 100,
                    height: 100,
                    colorDark: '#000000',
                    colorLight: '#ffffff'
                });

                new QRCode(document.getElementById('canva-qr-2'), {
                    text: 'CANVA-002',
                    width: 100,
                    height: 100,
                    colorDark: '#000000',
                    colorLight: '#ffffff'
                });

                new QRCode(document.getElementById('canva-qr-3'), {
                    text: 'CANVA-003',
                    width: 100,
                    height: 100,
                    colorDark: '#000000',
                    colorLight: '#ffffff'
                });
            }, 100);
        }

        // Download QR Code
        function downloadQRCode(qrId, elementId) {
            const canvas = document.querySelector(`#${elementId} canvas`);
            if (canvas) {
                const link = document.createElement('a');
                link.download = `${qrId}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                updateDynamicIsland('‚úÖ QR Code Downloaded!', 2000);
            }
        }

        // Download All QR Codes
        function downloadAllQRCodes() {
            const allQuestions = [
                ...QuantumMath.questions.perkalian,
                ...QuantumMath.questions.pembagian,
                ...QuantumMath.questions.pecahan,
                ...Object.values(QuantumMath.canvaQRCodes)
            ];

            allQuestions.forEach((q, index) => {
                setTimeout(() => {
                    const canvas = document.querySelector(`#qr-${index} canvas`);
                    if (canvas) {
                        const link = document.createElement('a');
                        link.download = `${q.id}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }
                }, index * 100);
            });

            updateDynamicIsland('üì• Semua QR Code Didownload!', 3000);
            showCustomAlert('‚úÖ Sukses', 'Semua QR Code sedang didownload. Periksa folder download Anda!');
        }

        // Download Canva Template
        function downloadCanvaTemplate(topic) {
            let qrText = '';
            let templateName = '';

            switch(topic) {
                case 'perkalian':
                    qrText = 'CANVA-001';
                    templateName = 'Template_Perkalian';
                    break;
                case 'pembagian':
                    qrText = 'CANVA-002';
                    templateName = 'Template_Pembagian';
                    break;
                case 'pecahan':
                    qrText = 'CANVA-003';
                    templateName = 'Template_Pecahan';
                    break;
            }

            // Create a temporary canvas for the template
            const tempCanvas = document.createElement('canvas');
            const ctx = tempCanvas.getContext('2d');
            tempCanvas.width = 800;
            tempCanvas.height = 600;

            // Background gradient based on topic
            let gradient;
            switch(topic) {
                case 'perkalian':
                    gradient = ctx.createLinearGradient(0, 0, 800, 600);
                    gradient.addColorStop(0, '#667eea');
                    gradient.addColorStop(1, '#764ba2');
                    break;
                case 'pembagian':
                    gradient = ctx.createLinearGradient(0, 0, 800, 600);
                    gradient.addColorStop(0, '#11998e');
                    gradient.addColorStop(1, '#38ef7d');
                    break;
                case 'pecahan':
                    gradient = ctx.createLinearGradient(0, 0, 800, 600);
                    gradient.addColorStop(0, '#f093fb');
                    gradient.addColorStop(1, '#f5576c');
                    break;
            }

            // Draw background
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 600);

            // Draw content
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('MATEMATIKA KELAS 3', 400, 80);
            
            ctx.font = '20px Arial';
            ctx.fillText('Scan QR Code untuk menjawab soal!', 400, 120);

            // Draw QR code area
            ctx.fillStyle = 'white';
            ctx.fillRect(300, 180, 200, 200);

            // Generate QR code for template
            const qrDiv = document.createElement('div');
            new QRCode(qrDiv, {
                text: qrText,
                width: 180,
                height: 180,
                colorDark: '#000000',
                colorLight: '#ffffff'
            });

            // Wait for QR code to render
            setTimeout(() => {
                const qrCanvas = qrDiv.querySelector('canvas');
                if (qrCanvas) {
                    ctx.drawImage(qrCanvas, 310, 190, 180, 180);
                }

                // Draw footer
                ctx.font = '16px Arial';
                ctx.fillText(`Soal: ${topic.charAt(0).toUpperCase() + topic.slice(1)} Dasar`, 400, 450);
                ctx.fillText('NAJIB AI BRAIN - Quantum QR Scanner v6.0', 400, 550);

                // Download the template
                const link = document.createElement('a');
                link.download = `${templateName}.png`;
                link.href = tempCanvas.toDataURL('image/png');
                link.click();

                updateDynamicIsland('üé® Template Canva Downloaded!', 2000);
            }, 100);
        }

        // Generate All Canva Templates
        function generateAllCanvaTemplates() {
            downloadCanvaTemplate('perkalian');
            setTimeout(() => downloadCanvaTemplate('pembagian'), 1000);
            setTimeout(() => downloadCanvaTemplate('pecahan'), 2000);
            
            setTimeout(() => {
                updateDynamicIsland('üé® Semua Template Siap!', 3000);
                showCustomAlert('‚úÖ Sukses', 'Semua template Canva sedang didownload. Siap untuk digunakan!');
            }, 3000);
        }

        function printQRCodes() {
            window.print();
        }

        // Developer Info
        function showDeveloperInfo() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            updateDynamicIsland('üë®‚Äçüè´ Developer Quantum Info', 3000);

            content.innerHTML = `
                <div style="padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                            üë®‚Äçüè´ Developer Information
                        </h2>
                        <button class="quantum-btn btn-danger" id="closeModalBtn">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>

                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="width: 150px; height: 150px; margin: 0 auto 20px; border-radius: 50%; background: var(--quantum-primary); display: flex; align-items: center; justify-content: center; box-shadow: var(--glow); position: relative; overflow: hidden;">
                            <img src="https://pfst.cf2.poecdn.net/base/image/450b057a0166b3d912e628ec6196299c9664597953096114352df3ff0dadf34f?w=3100&h=3100"
                                 alt="NAJIB AI BRAIN Logo"
                                 style="width: 100%; height: 100%; object-fit: contain;">
                        </div>
                        <h3 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary); margin-bottom: 10px;">
                            Muhammad Najib Wahidus Salam, S.Pd, Gr.
                        </h3>
                        <p style="font-size: 1.2rem; color: #667eea; margin-bottom: 15px; font-family: var(--font-display);">
                            Quantum Mathematics Educator & AI Architect
                        </p>
                        <div style="font-size: 1rem; font-weight: 700; color: var(--text-primary); font-family: var(--font-display);">
                            üöÄ Creator of NAJIB AI BRAIN Quantum QR Scanner Mathematics v6.0
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 20px; border: 2px solid #667eea;">
                            <h4 style="font-family: var(--font-display); color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">
                                üìã Personal Data
                            </h4>
                            <div style="color: var(--text-primary); font-weight: 600; line-height: 1.8; font-size: 14px;">
                                <div><strong>üè† Born:</strong> Sidoarjo, September 27, 1996</div>
                                <div><strong>üéì Education:</strong> S1-PGSD (2014-2021)</div>
                                <div><strong>üìú Certification:</strong> PPG Prajabatan 2024 Wave 1</div>
                                <div><strong>üë®‚Äçüè´ Profession:</strong> Non-ASN Teacher & AI Architect</div>
                                <div><strong>üé® Expertise:</strong> Quantum QR Educational Technology</div>
                                <div><strong>üí° Innovation:</strong> Interactive QR Scanner Learning</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1)); padding: 20px; border-radius: 20px; border: 2px solid #11998e;">
                            <h4 style="font-family: var(--font-display); color: #11998e; margin-bottom: 15px; font-size: 1.2rem;">
                                üèÜ Patent Status v6.0
                            </h4>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.2rem; margin-bottom: 10px; color: var(--text-primary); font-family: var(--font-display);">
                                    QUANTUM QR SCANNER MATHEMATICS v6.0
                                </div>
                                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea; font-family: var(--font-display); font-size: 13px;">
                                    PAT-NAJIB-AI-BRAIN-QR-MATH-v6.0-2025
                                </div>
                                <div style="color: #11998e; font-weight: 700; margin-bottom: 8px; font-size: 13px;">Protected by International Patent Law v6.0</div>
                                <div style="color: #f093fb; font-weight: 700; font-size: 13px;">First QR-based Mathematics Learning System</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1)); padding: 20px; border-radius: 20px; border: 2px solid #f093fb;">
                            <h4 style="font-family: var(--font-display); color: #f093fb; margin-bottom: 15px; font-size: 1.2rem;">
                                üì∫ YouTube Channel
                            </h4>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.2rem; margin-bottom: 10px; color: var(--text-primary); font-family: var(--font-display);">
                                    NA.Brothers Corp. #nuniversnys
                                </div>
                                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea; font-family: var(--font-display); font-size: 13px;">
                                    Official YouTube Corporation
                                </div>
                                <div style="color: #11998e; font-weight: 700; margin-bottom: 8px; font-size: 13px;">Original Music & Personal Corporation</div>
                                <div style="color: #f093fb; font-weight: 700; font-size: 13px;">Educational Content Creator</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(252, 70, 107, 0.1), rgba(63, 94, 251, 0.1)); padding: 20px; border-radius: 20px; border: 2px solid #fc466b;">
                            <h4 style="font-family: var(--font-display); color: #fc466b; margin-bottom: 15px; font-size: 1.2rem;">
                                üéØ Application Features
                            </h4>
                            <div style="color: var(--text-primary); font-weight: 600; line-height: 1.6; font-size: 13px;">
                                <div>‚úÖ Real-time QR Code Scanner with Browser Camera</div>
                                <div>‚úÖ Automatic Question Loading from QR</div>
                                <div>‚úÖ 30+ Mathematics Questions (Grade 3)</div>
                                <div>‚úÖ Multiplication, Division, Fractions</div>
                                <div>‚úÖ Multiple Choice & Input Questions</div>
                                <div>‚úÖ Instant Feedback System</div>
                                <div>‚úÖ Comprehensive Statistics Tracking</div>
                                <div>‚úÖ QR Code Generation & Printing</div>
                                <div>‚úÖ iPhone 17 Pro Dynamic Island UI</div>
                                <div>‚úÖ Cross-platform Camera Access</div>
                                <div>‚úÖ Canva QR Code Integration</div>
                                <div>‚úÖ Flexible QR Code Parsing System</div>
                                <div>‚úÖ Enhanced QR Database with Canva Support</div>
                                <div>‚úÖ Universal QR Scanner Mode</div>
                                <div>‚úÖ Scan History Management</div>
                                <div>‚úÖ Copy/Share/Open URL Functions</div>
                                <div>‚úÖ <strong>Enhanced Google Lens Integration</strong></div>
                                <div>‚úÖ Direct Lens Access for Smartphones</div>
                                <div>‚úÖ Image Upload for Lens Analysis</div>
                                <div>‚úÖ Lens Result Management</div>
                                <div>‚úÖ Advanced Camera Integration</div>
                                <div>‚úÖ <strong>PERBAIKAN: Camera Access Berkali-kali Tanpa Error</strong></div>
                            </div>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 20px; border: 2px solid #667eea; margin-bottom: 20px;">
                        <h4 style="font-family: var(--font-display); color: #667eea; margin-bottom: 15px; font-size: 1.3rem; text-align: center;">
                            üöÄ Enhanced Google Lens Integration v6.0
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; font-size: 13px; font-weight: 600; color: var(--text-primary);">
                            <div>‚úÖ Direct Google Lens App Access</div>
                            <div>‚úÖ Intent-based Mobile Integration</div>
                            <div>‚úÖ Camera Pre-authorization for Lens</div>
                            <div>‚úÖ Image Upload & Analysis Simulation</div>
                            <div>‚úÖ QR Code Detection from Images</div>
                            <div>‚úÖ Lens Result Display & Management</div>
                            <div>‚úÖ Copy/Save/Share Lens Results</div>
                            <div>‚úÖ Lens Usage Statistics Tracking</div>
                            <div>‚úÖ Enhanced Mobile Detection</div>
                            <div>‚úÖ Fallback Mechanisms for All Devices</div>
                            <div>‚úÖ Lens History Management</div>
                            <div>‚úÖ Advanced Image Processing Options</div>
                            <div>‚úÖ Multi-platform Support (Android/iOS/Web)</div>
                            <div>‚úÖ Seamless Camera-to-Lens Transition</div>
                            <div>‚úÖ Enhanced User Experience Design</div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <button class="quantum-btn btn-success" id="closeModalBtn2" style="margin-right: 15px;">
                            <i class="fas fa-heart"></i> Amazing Innovation, Prof. Najib!
                        </button>
                        <button class="quantum-btn btn-warning" id="exportProgressBtn2">
                            <i class="fas fa-file-export"></i> Export Progress
                        </button>
                    </div>
                </div>
            `;

            modal.classList.add('active');

            // Add event listeners
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('closeModalBtn2').addEventListener('click', closeModal);
            document.getElementById('exportProgressBtn2').addEventListener('click', exportProgress);
        }

        // Export Progress
        function exportProgress() {
            const timestamp = new Date().toLocaleString('id-ID');
            const sessionTime = Math.round((Date.now() - QuantumMath.stats.sessionStart) / 60000);
            const accuracy = QuantumMath.stats.correct + QuantumMath.stats.wrong > 0
                ? Math.round((QuantumMath.stats.correct / (QuantumMath.stats.correct + QuantumMath.stats.wrong)) * 100)
                : 0;

            const report = `
üåü NAJIB AI BRAIN - QUANTUM QR SCANNER MATHEMATICS v6.0 üåü
üöÄ Advanced QR-based Interactive Educational Technology Certificate
Generated: ${timestamp}

=== üìä QUANTUM LEARNING STATISTICS v6.0 ===
QR Codes Scanned: ${QuantumMath.stats.qrScanned}
Questions Answered: ${QuantumMath.stats.correct + QuantumMath.stats.wrong}
Correct Answers: ${QuantumMath.stats.correct} ‚úÖ
Wrong Answers: ${QuantumMath.stats.wrong} ‚ùå
Total Score: ${QuantumMath.stats.score} points ‚≠ê
Accuracy Rate: ${accuracy}%
Session Duration: ${sessionTime} minutes
Learning Efficiency: ${Math.round(QuantumMath.stats.score / Math.max(sessionTime, 1))} points/minute
Google Lens Used: ${QuantumMath.stats.lensUsed} times üîç

=== üîç ENHANCED GOOGLE LENS INTEGRATION ===
‚úÖ Universal QR Code Scanning
‚úÖ Direct Lens App Access
‚úÖ Image Upload for Lens Analysis
‚úÖ Text Recognition & Translation
‚úÖ Object & Landmark Detection
‚úÖ Product & Shopping Features
‚úÖ Plant & Animal Identification
‚úÖ Homework Help & Math Solutions
‚úÖ Camera Pre-authorization System
‚úÖ Multi-platform Support

=== üé® CANVA INTEGRATION FEATURES ===
‚úÖ Ready-to-use Canva Templates
‚úÖ Custom QR Code Designs
‚úÖ Downloadable Template Packages
‚úÖ Professional Layout Designs
‚úÖ Color-coded by Topic
‚úÖ Print-ready Formats
‚úÖ Easy Canva Upload Process
‚úÖ Enhanced QR Code Database
‚úÖ Flexible QR Parsing System

=== üåê UNIVERSAL SCANNER FEATURES ===
‚úÖ Dual Mode: Math Questions + Universal Scanner
‚úÖ Scan ANY QR Code (URL, Email, Phone, WiFi, vCard, Text)
‚úÖ Auto History Saving
‚úÖ Copy/Share/Open URL Functions
‚úÖ Scan History Management

=== üîß PERBAIKAN TEKNIS v6.1 ===
‚úÖ Camera Access Berkali-kali Tanpa Error
‚úÖ Enhanced Scanner Reset & Cleanup
‚úÖ Improved Error Handling
‚úÖ Better State Management
‚úÖ Stream Management Optimization

¬© 2025 NAJIB AI BRAIN Quantum QR Scanner Educational Technology v6.0
#nuniversnys - NA.Brothers Corp.
Developer: Muhammad Najib Wahidus Salam, S.Pd, Gr.
Protected by International Patent Law - All Rights Reserved
            `;

            // Create downloadable file
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `NAJIB-AI-BRAIN-QR-Math-Report-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            updateDynamicIsland('üìÑ Rapor Diekspor!', 2000);
            showCustomAlert('‚úÖ Sukses', 'Rapor pembelajaran berhasil diekspor!');
        }

        // Show Tutorial
        function showTutorial() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div style="padding: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary);">
                            üìö Tutorial Penggunaan
                        </h2>
                        <button class="quantum-btn btn-danger" id="closeModalBtn">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>

                    <div style="color: var(--text-primary); line-height: 1.8; font-size: 15px;">
                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #667eea;">
                            <h3 style="color: #667eea; font-family: var(--font-display); margin-bottom: 15px;">
                                üîç Enhanced Google Lens Integration
                            </h3>
                            <p><strong>Langkah 1:</strong> Klik tombol "Buka Google Lens" untuk mengakses fitur lengkap</p>
                            <p><strong>Langkah 2:</strong> Atau upload gambar untuk dianalisis oleh Lens</p>
                            <p><strong>Langkah 3:</strong> Gunakan "Direct Lens Access" untuk akses kamera langsung</p>
                            <p><strong>Langkah 4:</strong> Screenshot hasil analisis Lens</p>
                            <p><strong>Langkah 5:</strong> Upload screenshot kembali ke aplikasi</p>
                            <p><strong>Langkah 6:</strong> Hasil akan terintegrasi dengan sistem</p>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #11998e;">
                            <h3 style="color: #11998e; font-family: var(--font-display); margin-bottom: 15px;">
                                üì± Mode Scan QR Code - PERBAIKAN UTAMA
                            </h3>
                            <p><strong>Langkah 1:</strong> Klik "Buka Kamera" dan izinkan akses</p>
                            <p><strong>Langkah 2:</strong> Arahkan kamera ke QR Code dari Canva</p>
                            <p><strong>Langkah 3:</strong> Soal muncul otomatis - langsung jawab!</p>
                            <p><strong>Langkah 4:</strong> Dapatkan feedback instan</p>
                            <p><strong>Langkah 5:</strong> <strong>PERBAIKAN:</strong> Kamera bisa digunakan berkali-kali tanpa error!</p>
                            <p><strong>Langkah 6:</strong> Klik "Tutup Kamera" untuk berhenti scanning</p>
                            <p><strong>Langkah 7:</strong> Buka kembali kapan saja tanpa masalah</p>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #f093fb;">
                            <h3 style="color: #f093fb; font-family: var(--font-display); margin-bottom: 15px;">
                                üåê Mode Universal Scanner
                            </h3>
                            <p><strong>Langkah 1:</strong> Pilih "Mode Universal"</p>
                            <p><strong>Langkah 2:</strong> Klik "Buka Kamera"</p>
                            <p><strong>Langkah 3:</strong> Scan QR Code APAPUN dari luar</p>
                            <p><strong>Langkah 4:</strong> Hasil ditampilkan otomatis</p>
                            <p><strong>Langkah 5:</strong> Copy/Share/Open URL langsung</p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="quantum-btn btn-success" id="closeModalBtn2">
                            <i class="fas fa-check"></i> Siap Belajar!
                        </button>
                    </div>
                </div>
            `;

            modal.classList.add('active');

            // Add event listeners
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('closeModalBtn2').addEventListener('click', closeModal);
        }

        // Custom Alert
        function showCustomAlert(title, message) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div style="padding: 30px; text-align: center;">
                    <h2 style="font-family: var(--font-display); font-size: 1.8rem; color: var(--text-primary); margin-bottom: 20px;">
                        ${title}
                    </h2>
                    <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 25px; line-height: 1.6;">
                        ${message}
                    </p>
                    <button class="quantum-btn btn-primary" id="closeModalBtn">
                        <i class="fas fa-check"></i> OK
                    </button>
                </div>
            `;

            modal.classList.add('active');
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        }

        // Custom Confirm
        function showCustomConfirm(title, message, onConfirm) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div style="padding: 30px; text-align: center;">
                    <h2 style="font-family: var(--font-display); font-size: 1.8rem; margin-bottom: 20px;">${title}</h2>
                    <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 25px;">${message}</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="quantum-btn btn-danger" id="cancelBtn">
                            <i class="fas fa-times"></i> Batal
                        </button>
                        <button class="quantum-btn btn-success" id="confirmBtn">
                            <i class="fas fa-check"></i> Ya
                        </button>
                    </div>
                </div>
            `;

            modal.classList.add('active');
            
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('confirmBtn').addEventListener('click', function() {
                onConfirm();
                closeModal();
            });
        }

        // Close Modal
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>